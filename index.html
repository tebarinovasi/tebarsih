<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | Sistem Modern</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Supabase JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#1e293b] via-[#334155] to-[#0f172a] flex items-center justify-center">
  <div class="w-full max-w-md bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-white/20">
    <div class="flex justify-center mb-8">
      <img src="tbs-logo.png" alt="LOGO TEBARSIH" class="h-24 w-auto shadow-lg border-2 border-white/30 bg-white/20">
    </div>
    <div class="flex mb-6 rounded-lg overflow-hidden border border-white/20">
      <button id="tab-admin" class="flex-1 py-2 text-center font-semibold transition-all bg-white/20 text-slate-900 hover:bg-white/40 focus:bg-white/40" type="button">Admin</button>
      <button id="tab-petugas" class="flex-1 py-2 text-center font-semibold transition-all bg-transparent text-white hover:bg-white/10 focus:bg-white/10" type="button">Petugas</button>
    </div>
    <!-- Admin Login Form -->
    <form id="form-admin" class="space-y-5">
      <div>
        <label class="block text-white/80 mb-1 font-medium" for="admin-username">Username</label>
        <input id="admin-username" type="text" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="admin">
      </div>
      <div>
        <label class="block text-white/80 mb-1 font-medium" for="admin-password">Password</label>
        <input id="admin-password" type="password" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="••••••••">
      </div>
      <button type="submit" class="w-full py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-bold shadow-lg transition-all">Login Admin</button>
      <div id="admin-error" class="text-red-400 text-sm mt-2 hidden"></div>
    </form>
    <!-- Petugas Login Form -->
    <form id="form-petugas" class="space-y-5 hidden">
      <div>
        <label class="block text-white/80 mb-1 font-medium" for="petugas-email">Email</label>
        <input id="petugas-email" type="email" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="petugas@email.com">
      </div>
      <div>
        <label class="block text-white/80 mb-1 font-medium" for="petugas-password">Password</label>
        <input id="petugas-password" type="password" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="••••••••">
      </div>
      <button type="submit" class="w-full py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-bold shadow-lg transition-all">Login Petugas</button>
      <div id="petugas-error" class="text-red-400 text-sm mt-2 hidden"></div>
    </form>
    <div class="mt-8 text-center text-xs text-white/40">
      &copy; 2025 TELADAN BARAT BERSIH<br>Developed by GLOOMYDEV.
    </div>
  </div>
  <script>
    // Tab logic
    const tabAdmin = document.getElementById('tab-admin');
    const tabPetugas = document.getElementById('tab-petugas');
    const formAdmin = document.getElementById('form-admin');
    const formPetugas = document.getElementById('form-petugas');
    
    tabAdmin.onclick = () => {
      tabAdmin.classList.add('bg-white/20', 'text-slate-900');
      tabAdmin.classList.remove('bg-transparent', 'text-white');
      tabPetugas.classList.remove('bg-white/20', 'text-slate-900');
      tabPetugas.classList.add('bg-transparent', 'text-white');
      formAdmin.classList.remove('hidden');
      formPetugas.classList.add('hidden');
    };
    
    tabPetugas.onclick = () => {
      tabPetugas.classList.add('bg-white/20', 'text-slate-900');
      tabPetugas.classList.remove('bg-transparent', 'text-white');
      tabAdmin.classList.remove('bg-white/20', 'text-slate-900');
      tabAdmin.classList.add('bg-transparent', 'text-white');
      formPetugas.classList.remove('hidden');
      formAdmin.classList.add('hidden');
    };

    // Admin login (local)
    const adminData = {
      username: "admin",
      password: "admin123"
    };
    
    formAdmin.onsubmit = function(e) {
      e.preventDefault();
      const username = document.getElementById('admin-username').value.trim();
      const password = document.getElementById('admin-password').value;
      const errorDiv = document.getElementById('admin-error');
      
      if (username === adminData.username && password === adminData.password) {
        errorDiv.classList.add('hidden');
        window.location.href = "admin/dashboard.html";
      } else {
        errorDiv.textContent = "Username atau password admin salah!";
        errorDiv.classList.remove('hidden');
      }
    };

    // Petugas login (Supabase)
    // Replace with your Supabase URL and anon key
    const SUPABASE_URL = "https://bwtwcribfhbhizlbktlo.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ3dHdjcmliZmhiaGl6bGJrdGxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwNTQ3NDksImV4cCI6MjA2MTYzMDc0OX0.svH7YM8CORYoUfsE4YoovZMsoulWgr3xWT9X6qV39Mc";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    formPetugas.onsubmit = async function(e) {
      e.preventDefault();
      const email = document.getElementById('petugas-email').value.trim();
      const password = document.getElementById('petugas-password').value;
      const errorDiv = document.getElementById('petugas-error');
      errorDiv.classList.add('hidden');
      errorDiv.textContent = "";

      if (!email || !password) {
        errorDiv.textContent = "Email dan password wajib diisi!";
        errorDiv.classList.remove('hidden');
        return;
      }

      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
          errorDiv.textContent = "Email atau password petugas salah!";
          errorDiv.classList.remove('hidden');
        } else {
          // Tunggu session benar-benar tersimpan sebelum redirect
          setTimeout(() => {
            window.location.href = "petugas/dashboard.html";
          }, 300);
        }
      } catch (err) {
        errorDiv.textContent = "Terjadi kesalahan koneksi ke server!";
        errorDiv.classList.remove('hidden');
      }
    };
  </script>
</body>
</html>
